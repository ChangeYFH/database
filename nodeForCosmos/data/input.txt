  logStep("Replace item with id '" + item.id + "'");
  const { resource: updatedPerson } = await container.items.upsert(person);

  console.log("The '" + person.id + "' family has lastName '" + updatedPerson.lastName + "'");
  console.log("The '" + person.id + "' family has " + updatedPerson.children.length + " children '");

  logStep("Trying to replace item when item has changed in the database");
  // The replace item above will work even if there's a new version of item on the server from what you originally read
  // If you want to prevent this from happening you can opt-in to a conditional update
  // Using accessCondition and etag you can specify that the replace only occurs if the etag you are sending matches the etag on the server
  // i.e. Only replace if the item hasn't changed

  // let's go update item
  person.foo = "bar";
  await item.replace(person);

  // now let's try another update to item with accessCondition and etag set
  person.foo = "should never get set";
  try {
    await item.replace(person, { accessCondition: { type: "IfMatch", condition: person._etag } });
    throw new Error("This should have failed!");
  } catch (err) {
    if (err.code == 412) {
      console.log("As expected, the replace item failed with a pre-condition failure");
    } else {
      throw err;
    }
  }

  const upsertSource = itemDefList[1];
  logStep(`Upserting person ${upsertSource.id} with id ${upsertSource.id}...`);

  // a non-identity change will cause an update on upsert
  upsertSource.foo = "baz";
  const { resource: upsertedPerson1 } = await container.items.upsert(upsertSource);
  console.log(`Upserted ${upsertedPerson1.id} to id ${upsertedPerson1.id}.`);